$(function(){$(".btn-add").live("click",function(e){e.preventDefault();var t=$(this),n=t.siblings(".text"),r=n.data("id"),i=n.val(),s=$(".add-choice-url").val(),o={Choice:{question_id:r,text:i}},u=new Notifier;u.pending("Saving...");$.post(s,o,function(e){if(e.ok==1){u.success("Saved!");var r=e.data.Choice,s=r.id,o=$("<li />").addClass("answer"),a=$("<a />").addClass("btn-delete-choice btn-delete close").html("&times;");a.attr({href:"#","data-id":s}).data("id",s);var f=$("<input />").attr({type:"radio",disabled:"disabled"}).addClass("radio"),l=$("<span />").html(i);o.append(a).append(f).append(l);t.parent().before(o);n.val("")}},"json")});$(".text").live("keyup",function(e){e.preventDefault();e.keyCode==13&&$(this).next(".btn-add").click()});$(".btn-add-question").live("click",function(e){e.preventDefault();var t=$(this),n=$(".add-question-url").val(),r=$(".new-order").val(),i=$(".review-form-id").val(),s=$(".new-question").val(),o={Question:{review_form_id:i,text:s,position:r}},u=new Notifier;u.pending("Saving...");$.post(n,o,function(e){if(e.ok){u.success("Saved!");var t=e.data.Question;console.log(t);var n=t.id,r=t.position,i=t.text,s=$(".question-template").clone();s.find("a.close, input.text").attr("data-id",n).data("id",n);s.find("div.order").html(r);s.find("p.text").html(i);s.removeClass("hidden question-template");$(".questions").append(s)}},"json")});$(".btn-delete-choice").live("click",function(e){e.preventDefault();var t=$(this).data("id"),n=$(this).parent(),r=$(".delete-choice-url").val(),i={Choice:{id:t}},s=new Notifier;s.pending("Deleting...");$.post(r,i,function(e){if(e.ok){s.success("Deleted!");n.remove()}},"json")});$(".btn-delete-question").live("click",function(e){e.preventDefault();var t=confirm("Are you sure you want to delete this question?\nThis cannot be undone.");if(!t)return!1;var n=$(this),r=n.parent(),i=n.data("id"),s=$(".delete-question-url").val(),o={Question:{id:i}},u=new Notifier;u.pending("Deleting question...");$.post(s,o,function(e){if(e.ok){u.success("Deleted!");r.remove()}},"json")})});