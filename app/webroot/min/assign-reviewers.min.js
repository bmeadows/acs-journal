function resetSelections(){$(".user-badge, .submission-badge").reset()}function assign(e,t){var n=$(".assign-url").val(),r={Review:{user_id:e,submission_id:t,review_form_id:review_form_id}};$.post(n,r,function(n){if(n.ok){var r=n.data.Review,i=$('.user-badge[data-id="'+e+'"]'),s=parseInt(i.data("tag"))+1;i.data("tag",s);i.find(".user-tag span").html(s);var o=$('.submission-badge[data-id="'+t+'"]'),u=parseInt(o.data("reviews"))+1;o.data("reviews",u);o.find(".num-reviews span").html(u);user_reviews[e][r.id]=t;submission_reviews[t][r.id]=e}},"json")}function unassign(e,t){var n=$(".unassign-url").val(),r={Review:{user_id:e,submission_id:t,review_form_id:review_form_id}};$.post(n,r,function(n){var r=$('.user-badge[data-id="'+e+'"]'),i=parseInt(r.data("tag"))-1;r.data("tag",i);r.find(".user-tag span").html(i);var s=$('.submission-badge[data-id="'+t+'"]'),o=parseInt(s.data("reviews"))-1;s.data("reviews",o);s.find(".num-reviews span").html(o);for(var u in user_reviews[e])user_reviews[e][u]==t&&delete user_reviews[e][u];for(var u in submission_reviews[t])subission_reviews[t][u]==e&&delete submission_reviews[t][u]},"json")}const MODE_DEFAULT=0,MODE_ASSIGN_USERS=1,MODE_ASSIGN_PAPERS=2;var mode=MODE_DEFAULT,review_form_id=null;$(function(){function e(){review_form_id=parseInt($(".review-form-id").val());t()}function t(){$("#assign-reviewers .user-badge").click(function(e){e.preventDefault();if(mode==MODE_DEFAULT)$(this).assignPapers();else if(mode==MODE_ASSIGN_USERS)$(this).toggleUser();else if(mode==MODE_ASSIGN_PAPERS)if($(this).hasClass("active")){resetSelections();mode=MODE_DEFAULT}else $(this).switchUsers()});$("#assign-reviewers .submission-badge").click(function(e){e.preventDefault();if(mode==MODE_DEFAULT)$(this).assignUsers();else if(mode==MODE_ASSIGN_USERS)if($(this).hasClass("active")){resetSelections();mode=MODE_DEFAULT}else $(this).switchPapers();else mode==MODE_ASSIGN_PAPERS&&$(this).togglePaper()})}e()});jQuery.fn.deactivate=function(){$(this).removeClass("active selected").addClass("inactive")};jQuery.fn.activate=function(){$(this).removeClass("inactive selected").addClass("active")};jQuery.fn.select=function(){$(this).addClass("selected")};jQuery.fn.toggleSelected=function(){$(this).hasClass("selected")?$(this).deactivate():$(this).select()};jQuery.fn.reset=function(){$(this).removeClass("active inactive selected")};jQuery.fn.assignPapers=function(){mode=MODE_ASSIGN_PAPERS;$(this).switchUsers()};jQuery.fn.switchUsers=function(){$(this).siblings().deactivate();$(this).activate();$("#assign-reviewers .submission-badge").deactivate();var e=$(this).data("id"),t=user_reviews[e];for(var n in t)$('.submission-badge[data-id="'+t[n]+'"]').select()};jQuery.fn.toggleUser=function(){$(this).toggleSelected();var e=$(this).data("id"),t=$(".submission-badge.active").data("id");$(this).hasClass("selected")?assign(e,t):unassign(e,t)};jQuery.fn.assignUsers=function(){mode=MODE_ASSIGN_USERS;$(this).switchPapers()};jQuery.fn.switchPapers=function(){$(this).siblings().deactivate();$(this).activate();$("#assign-reviewers .user-badge").deactivate();var e=$(this).data("id"),t=submission_reviews[e];for(var n in t)$('.user-badge[data-id="'+t[n]+'"]').select()};jQuery.fn.togglePaper=function(){$(this).toggleSelected();var e=$(this).data("id"),t=$(".user-badge.active").data("id");$(this).hasClass("selected")?assign(t,e):unassign(t,e)};